<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TravelMate - Train Booking</title>
    <link rel="stylesheet" href="booking-modal.css" />
    <style>
      body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: url("project images/m1.jpg");
        min-height: 100vh;
      }

      .header {
        background: #008080;
        color: white;
        padding: 20px;
        text-align: center;
        position: relative;
      }

      .back-btn {
        position: absolute;
        top: 20px;
        left: 20px;
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 5px;
        cursor: pointer;
        text-decoration: none;
      }

      .container {
        max-width: 1000px;
        margin: 0 auto;
        padding: 20px;
      }

      .booking-card {
        background: white;
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
      }

      .service-header {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 2px solid #f0f0f0;
      }

      .service-icon {
        font-size: 48px;
        color: #008080;
      }

      .service-title {
        font-size: 28px;
        font-weight: bold;
        color: #008080;
      }

      .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .form-group {
        display: flex;
        flex-direction: column;
      }

      .form-group label {
        margin-bottom: 8px;
        font-weight: bold;
        color: #333;
      }

      .form-group input,
      .form-group select {
        padding: 15px;
        border: 2px solid #ddd;
        border-radius: 10px;
        font-size: 16px;
        transition: border-color 0.3s;
      }

      .form-group input:focus,
      .form-group select:focus {
        outline: none;
        border-color: #008080;
        box-shadow: 0 0 10px rgba(0, 128, 128, 0.1);
      }

      .location-input {
        position: relative;
      }

      .swap-btn {
        position: absolute;
        right: -15px;
        top: 50%;
        transform: translateY(-50%);
        background: #008080;
        color: white;
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        cursor: pointer;
        font-size: 18px;
        z-index: 10;
      }

      .search-btn {
        background: linear-gradient(45deg, #008080, #00a0a0);
        color: white;
        border: none;
        padding: 18px 40px;
        border-radius: 10px;
        font-size: 18px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s;
        width: 100%;
      }

      .search-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 128, 128, 0.3);
      }

      .search-results {
        background: white;
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        margin-top: 30px;
        display: none;
      }

      .result-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        border: 2px solid #f0f0f0;
        border-radius: 10px;
        margin-bottom: 15px;
        transition: all 0.3s;
      }

      .result-item:hover {
        border-color: #008080;
        box-shadow: 0 2px 8px rgba(0, 128, 128, 0.1);
      }

      .train-info {
        flex: 1;
      }

      .train-route {
        font-size: 18px;
        font-weight: bold;
        color: #008080;
        margin-bottom: 5px;
      }

      .train-details {
        color: #666;
        font-size: 14px;
        margin-bottom: 5px;
      }

      .train-price {
        font-size: 20px;
        font-weight: bold;
        color: #28a745;
        margin-right: 20px;
      }

      .book-btn {
        background: #008080;
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
        transition: all 0.3s ease;
      }

      .book-btn:hover {
        background: #006666;
        transform: translateY(-2px);
      }

      .popular-routes {
        background: white;
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .section-title {
        color: #008080;
        font-size: 24px;
        font-weight: bold;
        margin-bottom: 20px;
        text-align: center;
      }

      .routes-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
      }

      .route-card {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s;
        border: 2px solid transparent;
      }

      .route-card:hover {
        border-color: #008080;
        transform: translateY(-2px);
      }

      .message-box {
        position: fixed;
        top: 20px;
        right: 20px;
        background: white;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        border-left: 5px solid #008080;
        z-index: 1000;
        max-width: 400px;
        transform: translateX(100%);
        transition: transform 0.3s ease;
      }

      .message-box.show {
        transform: translateX(0);
      }

      .message-box.error {
        border-left-color: #dc3545;
      }

      .message-box.success {
        border-left-color: #28a745;
      }

      .message-box .close-btn {
        position: absolute;
        top: 10px;
        right: 15px;
        background: none;
        border: none;
        font-size: 20px;
        cursor: pointer;
        color: #666;
      }

      .message-title {
        font-weight: bold;
        margin-bottom: 10px;
        color: #333;
      }

      .message-content {
        color: #666;
        line-height: 1.5;
      }

      @media (max-width: 768px) {
        .form-grid {
          grid-template-columns: 1fr;
        }

        .result-item {
          flex-direction: column;
          align-items: flex-start;
          gap: 15px;
        }

        .message-box {
          top: 10px;
          right: 10px;
          left: 10px;
          max-width: none;
        }
      }
    </style>
  </head>
  <body>
    <div class="header">
      <a href="main.html" class="back-btn">← Back</a>
      <h1>Train Booking</h1>
      <p>Find the best deals for trains</p>
    </div>

    <div class="container">
      <div class="booking-card">
        <div class="service-header">
          <div class="service-title">Book Trains</div>
        </div>

        <div class="form-grid">
          <div class="form-group location-input">
            <label for="from">From Station</label>
            <input
              type="text"
              id="from"
              placeholder="Departure station"
              list="stations"
            />
            <button
              class="swap-btn"
              onclick="swapLocations()"
              title="Swap stations"
            >
              ⇄
            </button>
          </div>

          <div class="form-group">
            <label for="to">To Station</label>
            <input
              type="text"
              id="to"
              placeholder="Destination station"
              list="stations"
            />
          </div>

          <div class="form-group">
            <label for="date">Journey Date</label>
            <input type="date" id="date" />
          </div>

          <div class="form-group">
            <label for="class">Class</label>
            <select id="class">
              <option value="sleeper">Sleeper (SL)</option>
              <option value="3ac">AC 3 Tier (3A)</option>
              <option value="2ac">AC 2 Tier (2A)</option>
              <option value="1ac">AC First Class (1A)</option>
              <option value="cc">Chair Car (CC)</option>
            </select>
          </div>
        </div>

        <button class="search-btn" onclick="searchTrains()">
          Search Trains
        </button>
      </div>

      <div class="search-results" id="search-results">
        <div class="section-title">Available Trains</div>
        <div id="results-container"></div>
      </div>
    </div>

    <datalist id="stations">
      <option value="New Delhi (NDLS)"></option>
      <option value="Mumbai Central (BCT)"></option>
      <option value="Bangalore City (SBC)"></option>
      <option value="Chennai Central (MAS)"></option>
      <option value="Howrah (HWH)"></option>
      <option value="Secunderabad (SC)"></option>
      <option value="Pune (PUNE)"></option>
      <option value="Ahmedabad (ADI)"></option>
      <option value="Jaipur (JP)"></option>
    </datalist>

    <script src="booking-modal.js"></script>
    <script>
      function swapLocations() {
        const fromField = document.getElementById("from");
        const toField = document.getElementById("to");

        const temp = fromField.value;
        fromField.value = toField.value;
        toField.value = temp;
      }

      function quickSelect(from, to) {
        document.getElementById("from").value = from;
        document.getElementById("to").value = to;
      }

      function showMessage(title, message, type = "info") {
        const existingBox = document.querySelector(".message-box");
        if (existingBox) {
          existingBox.remove();
        }

        const messageBox = document.createElement("div");
        messageBox.className = `message-box ${type}`;
        messageBox.innerHTML = `
        <button class="close-btn" onclick="this.parentElement.remove()">×</button>
        <div class="message-title">${title}</div>
        <div class="message-content">${message}</div>
      `;

        document.body.appendChild(messageBox);

        setTimeout(() => {
          messageBox.classList.add("show");
        }, 100);

        setTimeout(() => {
          if (messageBox.parentElement) {
            messageBox.classList.remove("show");
            setTimeout(() => messageBox.remove(), 300);
          }
        }, 5000);
      }

      function searchTrains() {
        const from = document.getElementById("from").value;
        const to = document.getElementById("to").value;
        const date = document.getElementById("date").value;

        if (!from || !to || !date) {
          showMessage(
            "Missing Information",
            "Please fill in all required fields (From Station, To Station, and Journey Date)",
            "error"
          );
          return;
        }

        showSearchResults(from, to, date);
        showMessage(
          "Search Complete",
          `Found trains for your journey from ${from
            .split("(")[0]
            .trim()} to ${to.split("(")[0].trim()}`,
          "success"
        );
      }

      function showSearchResults(from, to, date) {
        const resultsContainer = document.getElementById("results-container");
        const searchResults = document.getElementById("search-results");

        const trains = [
          "Rajdhani Express",
          "Shatabdi Express",
          "Duronto Express",
          "Garib Rath",
          "Jan Shatabdi",
        ];
        const results = [];

        for (let i = 0; i < 5; i++) {
          const train = trains[i];
          const price = 800 + Math.random() * 1500;
          const departTime = `${6 + i * 2}:${Math.floor(Math.random() * 60)
            .toString()
            .padStart(2, "0")}`;
          const arriveTime = `${14 + i * 2}:${Math.floor(Math.random() * 60)
            .toString()
            .padStart(2, "0")}`;

          results.push({
            id: `TR${Date.now()}_${i}`,
            train: train,
            route: `${from.split("(")[0].trim()} → ${to.split("(")[0].trim()}`,
            departure: departTime,
            arrival: arriveTime,
            duration: "8h 30m",
            price: Math.round(price),
            date: date,
          });
        }

        resultsContainer.innerHTML = "";
        results.forEach((train) => {
          const resultItem = document.createElement("div");
          resultItem.className = "result-item";
          resultItem.innerHTML = `
          <div class="train-info">
            <div class="train-route">${train.route}</div>
            <div class="train-details">${train.train} • ${train.departure} - ${
            train.arrival
          }</div>
            <div class="train-details">${train.duration} • ${new Date(
            train.date
          ).toLocaleDateString()}</div>
          </div>
          <div class="train-price">₹${train.price.toLocaleString()}</div>
          <button class="book-btn" onclick="bookTrain('${train.id}', '${
            train.price
          }', '${from}', '${to}', '${date}', '${train.train}', '${
            train.departure
          }', '${train.arrival}')">
            Book Now
          </button>
        `;
          resultsContainer.appendChild(resultItem);
        });

        searchResults.style.display = "block";
        searchResults.scrollIntoView({ behavior: "smooth" });
      }

      function bookTrain(
        id,
        price,
        from,
        to,
        date,
        trainName,
        departure,
        arrival
      ) {
        const user = JSON.parse(
          localStorage.getItem("travelmate_current_user") || "null"
        );

        if (!user) {
          showMessage(
            "Login Required",
            "Please login to book trains. Redirecting to login page...",
            "error"
          );
          setTimeout(() => {
            window.location.href = "login.html";
          }, 2000);
          return;
        }

        const trainData = {
          id: id,
          type: "train",
          title: `${trainName}`,
          from: from.split("(")[0].trim(),
          to: to.split("(")[0].trim(),
          date: date,
          time: `${departure} - ${arrival}`,
          price: `₹${price}`,
          train: trainName,
          departure: departure,
          arrival: arrival,
        };
        window.showBookingModal(trainData);
      }

      document.addEventListener("DOMContentLoaded", function () {
        const today = new Date().toISOString().split("T")[0];
        document.getElementById("date").min = today;
      });
    </script>
  </body>
</html>
